// Prisma schema for the EasyASTA application.
// Defines the data model for applicants, applications and payments. Sensitive
// fields such as passportNumber are stored encrypted at rest using the helper
// functions in the application code (not shown here).

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Applicant {
  id             String    @id @default(cuid())
  fullName       String
  email          String
  passportNumber String    // encrypted value
  country        String
  applications   Application[]
  createdAt      DateTime  @default(now())
}

model Application {
  id           String    @id @default(cuid())
  reference    String    @unique
  status       String    @default("draft")
  applicantId  String
  applicant    Applicant @relation(fields: [applicantId], references: [id])
  payment      Payment?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Payment {
  id            String    @id @default(cuid())
  applicationId String    @unique
  application   Application @relation(fields: [applicationId], references: [id])
  amount        Int
  currency      String
  status        String
  transactionId String
  createdAt     DateTime @default(now())
}